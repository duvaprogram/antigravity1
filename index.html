<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Domicilios - Quito & Guayaquil</title>
    <meta name="description" content="Sistema de gesti√≥n de domicilios para Quito y Guayaquil">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <!-- SheetJS for Excel file reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <span class="login-logo">üì¶</span>
                <h1>Sistema de Domicilios</h1>
                <p>Ingresa tus credenciales para continuar</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginUsername">Usuario</label>
                    <input type="text" id="loginUsername" required placeholder="Tu usuario" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Contrase√±a</label>
                    <input type="password" id="loginPassword" required placeholder="Tu contrase√±a"
                        autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-full">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                        <polyline points="10 17 15 12 10 7"></polyline>
                        <line x1="15" y1="12" x2="3" y2="12"></line>
                    </svg>
                    Iniciar Sesi√≥n
                </button>
                <div id="loginError" class="login-error" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- App Container (hidden until login) -->
    <div class="app-container" id="appContainer" style="display: none;">

        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üì¶</span>
                    <span class="logo-text">Domicilios</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-section="dashboard">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="#products" class="nav-item" data-section="products">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    <span>Productos</span>
                </a>
                <a href="#inventory" class="nav-item" data-section="inventory">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                    </svg>
                    <span>Inventario</span>
                </a>
                <a href="#clients" class="nav-item" data-section="clients">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Clientes</span>
                </a>
                <a href="#guides" class="nav-item" data-section="guides">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span>Gu√≠as de Despacho</span>
                </a>
                <a href="#analytics" class="nav-item" data-section="analytics">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    <span>An√°lisis de Datos</span>
                </a>
                <a href="#confirmation" class="nav-item" data-section="confirmation">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"></path>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                    </svg>
                    <span>Confirmaci√≥n</span>
                </a>
                <a href="#purchases" class="nav-item" data-section="purchases">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span>Compras</span>
                </a>
                <a href="#accounts" class="nav-item nav-admin-only" data-section="accounts" style="display: none;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                        <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg>
                    <span>Cuentas</span>
                </a>
                <!-- Admin only: Users management -->
                <a href="#users" class="nav-item nav-admin-only" data-section="users" style="display: none;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Usuarios</span>
                </a>
                <a href="#campaigns" class="nav-item" data-section="campaigns">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <span>Campa√±as</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <!-- User info -->
                <div class="user-info" id="userInfo"
                    style="margin-bottom: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: var(--radius-md);">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div
                            style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                            <span id="userInitial">A</span>
                        </div>
                        <div style="flex: 1;">
                            <div id="userDisplayName" style="font-size: 0.875rem; font-weight: 500;">Admin</div>
                            <div id="userRole" style="font-size: 0.7rem; color: var(--text-muted);">Administrador</div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-full" onclick="AuthModule.logout()" style="margin-bottom: 0.5rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Cerrar Sesi√≥n
                </button>
                <div class="city-selector">
                    <label>Ciudad activa:</label>
                    <select id="activeCity">
                        <option value="all">Todas</option>
                        <option value="Quito">Quito</option>
                        <option value="Guayaquil">Guayaquil</option>
                        <option value="Caracas">Caracas</option>
                    </select>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-header">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <h1 id="pageTitle">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-icon theme-toggle" id="themeToggle" title="Cambiar tema">
                        <!-- Sun Icon (for dark mode) -->
                        <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" style="display: none;">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <!-- Moon Icon (for light mode) -->
                        <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                    <span class="current-time" id="currentTime"></span>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section class="content-section active" id="section-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon products">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                </path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="statProducts">0</span>
                            <span class="stat-label">Productos</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon inventory">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="statInventory">0</span>
                            <span class="stat-label">Unidades en Stock</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon clients">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="statClients">0</span>
                            <span class="stat-label">Clientes</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon guides">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="statGuides">0</span>
                            <span class="stat-label">Gu√≠as de Hoy</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(34, 197, 94, 0.1); color: #22c55e;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="statTotalProductCost">$0</span>
                            <span class="stat-label">Costo Inventario</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card recent-guides">
                        <div class="card-header">
                            <h3>Gu√≠as Recientes</h3>
                            <a href="#guides" class="btn btn-text" data-section="guides">Ver todas</a>
                        </div>
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>N¬∫ Gu√≠a</th>
                                        <th>Cliente</th>
                                        <th>Ciudad</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="recentGuidesTable">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card low-stock">
                        <div class="card-header">
                            <h3>Stock Bajo</h3>
                            <a href="#inventory" class="btn btn-text" data-section="inventory">Ver inventario</a>
                        </div>
                        <div class="card-body">
                            <ul class="stock-list" id="lowStockList">
                                <!-- Dynamic content -->
                            </ul>
                        </div>
                    </div>

                    <div class="card city-stats">
                        <div class="card-header">
                            <h3>Despachos por Ciudad</h3>
                        </div>
                        <div class="card-body">
                            <div class="city-chart">
                                <div class="city-bar">
                                    <span class="city-name">Quito</span>
                                    <div class="bar-container">
                                        <div class="bar quito" id="quitoBar" style="width: 0%"></div>
                                    </div>
                                    <span class="city-count" id="quitoCount">0</span>
                                </div>
                                <div class="city-bar">
                                    <span class="city-name">Guayaquil</span>
                                    <div class="bar-container">
                                        <div class="bar guayaquil" id="guayaquilBar" style="width: 0%"></div>
                                    </div>
                                    <span class="city-count" id="guayaquilCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section class="content-section" id="section-products">
                <div class="section-header">
                    <div class="search-bar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="searchProducts" placeholder="Buscar productos...">
                    </div>
                    <button class="btn btn-primary" id="btnNewProduct">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Nuevo Producto
                    </button>
                </div>

                <div class="filters-bar">
                    <select id="filterStatus">
                        <option value="">Todos los estados</option>
                        <option value="true">Activos</option>
                        <option value="false">Inactivos</option>
                    </select>
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Nombre</th>
                                <th>N¬∫ Import.</th>
                                <th>Costo</th>
                                <th>Precio</th>
                                <th>Fecha Creaci√≥n</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Inventory Section -->
            <section class="content-section" id="section-inventory">
                <div class="section-header">
                    <div class="city-tabs">
                        <button class="city-tab active" data-city="all">Todos</button>
                        <button class="city-tab" data-city="Quito">Quito</button>
                        <button class="city-tab" data-city="Guayaquil">Guayaquil</button>
                        <button class="city-tab" data-city="Caracas">Caracas</button>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" id="btnInventoryHistory">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Historial
                        </button>
                        <button class="btn btn-primary" id="btnUpdateStock">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="1 4 1 10 7 10"></polyline>
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                            </svg>
                            Actualizar Stock
                        </button>
                    </div>
                </div>

                <!-- Inventory Filters Bar -->
                <div class="inventory-filters-bar">
                    <div class="inv-search-bar">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="invSearchInput" placeholder="Buscar por nombre o SKU...">
                    </div>
                    <select id="invSortSelect">
                        <option value="default">Orden original</option>
                        <option value="stock-desc">Mayor a menor stock</option>
                        <option value="stock-asc">Menor a mayor stock</option>
                        <option value="name-asc">Nombre A ‚Üí Z</option>
                        <option value="name-desc">Nombre Z ‚Üí A</option>
                    </select>
                    <select id="invCategorySelect">
                        <option value="">Todas las categor√≠as</option>
                    </select>
                    <button class="btn btn-secondary btn-sm" id="btnClearInvFilters" title="Limpiar filtros">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        Limpiar
                    </button>
                </div>

                <!-- Results counter -->
                <div class="inventory-count" id="inventoryCount"></div>

                <div class="inventory-grid" id="inventoryGrid">
                    <!-- Dynamic content -->
                </div>
            </section>

            <!-- Clients Section -->
            <section class="content-section" id="section-clients">
                <div class="section-header">
                    <div class="search-bar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="searchClients" placeholder="Buscar por nombre o tel√©fono...">
                    </div>
                    <button class="btn btn-primary" id="btnNewClient">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Nuevo Cliente
                    </button>
                </div>

                <div class="clients-grid" id="clientsGrid">
                    <!-- Dynamic content -->
                </div>
            </section>

            <!-- Guides Section -->
            <section class="content-section" id="section-guides">
                <div class="section-header">
                    <div class="search-bar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="searchGuides" placeholder="Buscar gu√≠as...">
                    </div>
                    <div class="header-buttons">
                        <button class="btn btn-primary" id="btnNewGuide">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Nueva Gu√≠a
                        </button>
                    </div>
                </div>

                <!-- Filters Row -->
                <div class="filters-bar" style="margin-bottom: 1rem; flex-wrap: wrap;">
                    <select id="filterGuideCity">
                        <option value="">Todas las ciudades</option>
                        <option value="Quito">Quito</option>
                        <option value="Guayaquil">Guayaquil</option>
                        <option value="Caracas">Caracas</option>
                    </select>
                    <select id="filterGuideStatus">
                        <option value="">Todos los estados</option>
                        <option value="Pendiente">Pendiente</option>
                        <option value="En ruta">En ruta</option>
                        <option value="Entregado">Entregado</option>
                        <option value="Pagado">Pagado</option>
                        <option value="Novedad">Novedad</option>
                        <option value="Cancelado">Cancelado</option>
                        <option value="Devoluci√≥n">Devoluci√≥n</option>
                    </select>
                    <select id="filterGuidePayment">
                        <option value="">Todas las monedas</option>
                        <option value="USD">Divisa (USD)</option>
                        <option value="BS">Pago M√≥vil (Bs)</option>
                    </select>
                    <input type="date" id="filterGuideDate"
                        style="padding: 0.5rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-md); color: var(--text-primary);">
                    <button class="btn btn-secondary" id="btnClearFilters" title="Limpiar filtros">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        Limpiar
                    </button>
                </div>

                <div class="guides-layout" id="guidesLayout">
                    <div class="guides-table-wrapper">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>N¬∫ Gu√≠a</th>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Ciudad</th>
                                        <th>Productos</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="guidesTable">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Novedades Panel -->
                    <div class="novedades-panel" id="novedadesPanel" style="display: none;">
                        <div class="novedades-panel-header">
                            <h3>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                                    </path>
                                    <line x1="12" y1="9" x2="12" y2="13"></line>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                Novedades
                                <span class="novedades-count" id="novedadesCount">0</span>
                            </h3>
                        </div>
                        <div class="novedades-panel-body" id="novedadesList">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section class="content-section" id="section-analytics">
                <div class="section-header">
                    <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        An√°lisis de Datos
                    </h2>
                    <button class="btn btn-primary" onclick="AnalyticsModule.refreshData()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="1 4 1 10 7 10"></polyline>
                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                        </svg>
                        Actualizar
                    </button>
                </div>

                <!-- Filters Panel -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="card-header"
                        style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
                        <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                            </svg>
                            Filtros de An√°lisis
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="analytics-filters"
                            style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end;">
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="analyticsDateFrom"
                                    style="font-size: 0.75rem; color: var(--text-muted);">Desde</label>
                                <input type="date" id="analyticsDateFrom" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="analyticsDateTo"
                                    style="font-size: 0.75rem; color: var(--text-muted);">Hasta</label>
                                <input type="date" id="analyticsDateTo" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="analyticsCity"
                                    style="font-size: 0.75rem; color: var(--text-muted);">Pa√≠s/Ciudad</label>
                                <select id="analyticsCity" class="form-control">
                                    <option value="">Todos</option>
                                    <option value="Quito">Ecuador - Quito</option>
                                    <option value="Guayaquil">Ecuador - Guayaquil</option>
                                    <option value="Caracas">Venezuela - Caracas</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="analyticsStatus"
                                    style="font-size: 0.75rem; color: var(--text-muted);">Estado</label>
                                <select id="analyticsStatus" class="form-control">
                                    <option value="">Todos</option>
                                    <option value="Pendiente">Pendiente</option>
                                    <option value="En ruta">En ruta</option>
                                    <option value="Entregado">Entregado</option>
                                    <option value="Pagado">Pagado</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 200px; position: relative;">
                                <label for="analyticsProductSearch"
                                    style="font-size: 0.75rem; color: var(--text-muted);">Producto</label>
                                <input type="text" id="analyticsProductSearch" class="form-control"
                                    placeholder="Buscar producto..." autocomplete="off">
                                <input type="hidden" id="analyticsProduct" value="">
                                <div id="analyticsProductSuggestions" class="product-suggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; 
                                    background: var(--surface); border: 1px solid var(--border); 
                                    border-radius: var(--radius-md); max-height: 200px; overflow-y: auto; 
                                    z-index: 1000; box-shadow: var(--shadow-lg);">
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <div class="quick-filters" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button type="button" class="btn btn-secondary btn-sm"
                                    onclick="AnalyticsModule.setQuickFilter('week')">Esta Semana</button>
                                <button type="button" class="btn btn-secondary btn-sm"
                                    onclick="AnalyticsModule.setQuickFilter('month')">Este Mes</button>
                                <button type="button" class="btn btn-secondary btn-sm"
                                    onclick="AnalyticsModule.setQuickFilter('year')">Este A√±o</button>
                                <button type="button" class="btn btn-secondary btn-sm"
                                    onclick="AnalyticsModule.setQuickFilter('all')">Todo</button>
                            </div>
                            <button type="button" class="btn btn-outline btn-sm"
                                onclick="AnalyticsModule.clearFilters()" style="margin-left: auto;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                                Limpiar Filtros
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Summary Stats Cards -->
                <div class="analytics-stats-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="stat-card analytics-stat">
                        <div class="stat-icon" style="background: rgba(99, 102, 241, 0.1); color: #6366f1;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsTotal">0</span>
                            <span class="stat-label">Total Gu√≠as</span>
                        </div>
                    </div>
                    <div class="stat-card analytics-stat">
                        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsDelivered">0</span>
                            <span class="stat-label">Entregadas</span>
                        </div>
                    </div>
                    <div class="stat-card analytics-stat">
                        <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsPaid">0</span>
                            <span class="stat-label">Pagadas</span>
                        </div>
                    </div>
                    <div class="stat-card analytics-stat">
                        <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: #ef4444;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsCancelled">0</span>
                            <span class="stat-label">Canceladas</span>
                        </div>
                    </div>
                    <div class="stat-card analytics-stat">
                        <div class="stat-icon" style="background: rgba(59, 130, 246, 0.1); color: #3b82f6;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsTotalUsd">$0</span>
                            <span class="stat-label">Total USD</span>
                        </div>
                    </div>
                    <div class="stat-card analytics-stat" id="analyticsTotalBsCard">
                        <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: #f59e0b;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsTotalBs">0 Bs</span>
                            <span class="stat-label">Total Bs</span>
                        </div>
                    </div>
                    <!-- Valor Total de Gu√≠as -->
                    <div class="stat-card analytics-stat">
                        <div class="stat-icon" style="background: rgba(34, 197, 94, 0.1); color: #22c55e;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsTotalGuideValue">$0.00</span>
                            <span class="stat-label">üí∞ Valor Total Gu√≠as</span>
                        </div>
                    </div>
                    <!-- Total Fletes -->
                    <div class="stat-card analytics-stat">
                        <div class="stat-icon" style="background: rgba(168, 85, 247, 0.1); color: #a855f7;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="1" y="3" width="15" height="13"></rect>
                                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                <circle cx="18.5" cy="18.5" r="2.5"></circle>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="analyticsTotalShippingValue">$0.00</span>
                            <span class="stat-label">üöö Total Fletes</span>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr;">
                    <!-- Guides by City -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Gu√≠as por Ciudad</h3>
                        </div>
                        <div class="card-body">
                            <div class="city-chart" id="analyticsCityChart">
                                <div class="city-bar">
                                    <span class="city-name">Quito</span>
                                    <div class="bar-container">
                                        <div class="bar quito" id="analyticsQuitoBar" style="width: 0%"></div>
                                    </div>
                                    <span class="city-count" id="analyticsQuitoCount">0</span>
                                </div>
                                <div class="city-bar">
                                    <span class="city-name">Guayaquil</span>
                                    <div class="bar-container">
                                        <div class="bar guayaquil" id="analyticsGuayaquilBar" style="width: 0%"></div>
                                    </div>
                                    <span class="city-count" id="analyticsGuayaquilCount">0</span>
                                </div>
                                <div class="city-bar">
                                    <span class="city-name">Caracas</span>
                                    <div class="bar-container">
                                        <div class="bar caracas" id="analyticsCaracasBar" style="width: 0%"></div>
                                    </div>
                                    <span class="city-count" id="analyticsCaracasCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Guides by Status -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Gu√≠as por Estado</h3>
                        </div>
                        <div class="card-body">
                            <div class="status-chart" id="analyticsStatusChart">
                                <div class="status-bar"
                                    style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                                    <span style="width: 80px; font-size: 0.875rem; font-weight: 500;">Pendiente</span>
                                    <div class="bar-container" style="flex: 1;">
                                        <div class="bar" id="analyticsPendienteBar"
                                            style="width: 0%; background: linear-gradient(135deg, #f59e0b, #d97706);">
                                        </div>
                                    </div>
                                    <span class="status-count" style="width: 40px; text-align: right; font-weight: 600;"
                                        id="analyticsPendienteCount">0</span>
                                </div>
                                <div class="status-bar"
                                    style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                                    <span style="width: 80px; font-size: 0.875rem; font-weight: 500;">En ruta</span>
                                    <div class="bar-container" style="flex: 1;">
                                        <div class="bar" id="analyticsEnRutaBar"
                                            style="width: 0%; background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                                        </div>
                                    </div>
                                    <span class="status-count" style="width: 40px; text-align: right; font-weight: 600;"
                                        id="analyticsEnRutaCount">0</span>
                                </div>
                                <div class="status-bar"
                                    style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                                    <span style="width: 80px; font-size: 0.875rem; font-weight: 500;">Entregado</span>
                                    <div class="bar-container" style="flex: 1;">
                                        <div class="bar" id="analyticsEntregadoBar"
                                            style="width: 0%; background: linear-gradient(135deg, #10b981, #059669);">
                                        </div>
                                    </div>
                                    <span class="status-count" style="width: 40px; text-align: right; font-weight: 600;"
                                        id="analyticsEntregadoCount">0</span>
                                </div>
                                <div class="status-bar"
                                    style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                                    <span style="width: 80px; font-size: 0.875rem; font-weight: 500;">Pagado</span>
                                    <div class="bar-container" style="flex: 1;">
                                        <div class="bar" id="analyticsPagadoBar"
                                            style="width: 0%; background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                                        </div>
                                    </div>
                                    <span class="status-count" style="width: 40px; text-align: right; font-weight: 600;"
                                        id="analyticsPagadoCount">0</span>
                                </div>
                                <div class="status-bar" style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="width: 80px; font-size: 0.875rem; font-weight: 500;">Cancelado</span>
                                    <div class="bar-container" style="flex: 1;">
                                        <div class="bar" id="analyticsCanceladoBar"
                                            style="width: 0%; background: linear-gradient(135deg, #ef4444, #dc2626);">
                                        </div>
                                    </div>
                                    <span class="status-count" style="width: 40px; text-align: right; font-weight: 600;"
                                        id="analyticsCanceladoCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Guides by Currency -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Gu√≠as por Moneda</h3>
                        </div>
                        <div class="card-body">
                            <div class="currency-stats"
                                style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                <div class="currency-card" id="analyticsUsdCurrencyCard"
                                    style="background: var(--surface-hover); padding: 1.25rem; border-radius: var(--radius-lg); text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: #10b981;"
                                        id="analyticsUsdCount">0</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Gu√≠as con USD</div>
                                    <div style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary); margin-top: 0.5rem;"
                                        id="analyticsUsdAmount">$0.00</div>
                                </div>
                                <div class="currency-card" id="analyticsBsCurrencyCard"
                                    style="background: var(--surface-hover); padding: 1.25rem; border-radius: var(--radius-lg); text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: #3b82f6;"
                                        id="analyticsBsCount">0</div>
                                    <div style="font-size: 0.875rem; color: var(--text-muted);">Gu√≠as con Bs</div>
                                    <div style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary); margin-top: 0.5rem;"
                                        id="analyticsBsAmount">0.00 Bs</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Selling Products -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Productos M√°s Vendidos</h3>
                        </div>
                        <div class="card-body" style="padding: 0;">
                            <div class="table-container" style="border: none; border-radius: 0;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Producto</th>
                                            <th>Cantidad</th>
                                            <th>Ingresos</th>
                                        </tr>
                                    </thead>
                                    <tbody id="analyticsTopProducts">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Table -->
                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">
                        <h3>Detalle de Gu√≠as Filtradas</h3>
                        <span id="analyticsRecordCount" style="font-size: 0.875rem; color: var(--text-muted);"></span>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div class="table-container"
                            style="border: none; border-radius: 0; max-height: 400px; overflow-y: auto;">
                            <table class="table">
                                <thead style="position: sticky; top: 0; background: var(--surface-hover);">
                                    <tr>
                                        <th>N¬∫ Gu√≠a</th>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Ciudad</th>
                                        <th>Total</th>
                                        <th>Flete</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="analyticsGuidesTable">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Confirmation Section -->
            <section class="content-section" id="section-confirmation">
                <div class="section-header">
                    <h2>Confirmaci√≥n de Pedidos</h2>
                </div>

                <!-- Single Stats Panel with Calendar Filters -->
                <div class="card stats-main-panel" style="margin-bottom: 1.5rem;">
                    <div class="card-header"
                        style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
                        <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            M√©tricas de Efectividad
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- Date Filter Row -->
                        <div class="period-filter-row"
                            style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">
                            <div class="form-group" style="flex: 1; min-width: 140px;">
                                <label for="statDateFrom"
                                    style="font-size: 0.75rem; color: var(--text-muted);">Desde</label>
                                <input type="date" id="statDateFrom" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 140px;">
                                <label for="statDateTo"
                                    style="font-size: 0.75rem; color: var(--text-muted);">Hasta</label>
                                <input type="date" id="statDateTo" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 140px;">
                                <label for="statPage"
                                    style="font-size: 0.75rem; color: var(--text-muted);">P√°gina</label>
                                <select id="statPage" class="form-control">
                                    <option value="">Todas</option>
                                    <option value="Colombia">Colombia</option>
                                    <option value="Ecuador">Ecuador</option>
                                    <option value="Venezuela">Venezuela</option>
                                </select>
                            </div>
                            <div class="quick-filters" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button type="button" class="btn btn-secondary btn-sm"
                                    onclick="ConfirmationModule.setQuickFilter('week')">Esta Semana</button>
                                <button type="button" class="btn btn-secondary btn-sm"
                                    onclick="ConfirmationModule.setQuickFilter('month')">Este Mes</button>
                                <button type="button" class="btn btn-secondary btn-sm"
                                    onclick="ConfirmationModule.setQuickFilter('all')">Todo</button>
                            </div>
                        </div>

                        <!-- Stats Grid -->
                        <div class="stats-period-grid"
                            style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                            <div class="stat-item">
                                <span class="stat-label">Total Pedidos</span>
                                <span class="stat-value" id="periodTotalOrders">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Confirmados</span>
                                <span class="stat-value stat-success" id="periodConfirmed">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">% Bruto</span>
                                <span class="stat-value stat-primary" id="periodGrossPercent">0%</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">% Neto</span>
                                <span class="stat-value stat-accent" id="periodNetPercent">0%</span>
                            </div>
                        </div>

                        <!-- Period Info -->
                        <div class="stat-period-range" id="periodDateRange" style="margin-top: 1rem;">Selecciona un
                            rango de
                            fechas</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Registration Form -->
                    <div class="card" style="grid-row: span 2;">
                        <div class="card-header">
                            <h3>Nuevo Registro Diario</h3>
                        </div>
                        <div class="card-body">
                            <form id="formConfirmation">
                                <div class="form-grid">
                                    <div class="form-group full-width">
                                        <label for="confDate">Fecha</label>
                                        <input type="date" id="confDate" required>
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="confPage">P√°gina / Origen</label>
                                        <select id="confPage" required>
                                            <option value="">Seleccionar...</option>
                                            <option value="Colombia">Colombia</option>
                                            <option value="Ecuador">Ecuador</option>
                                            <option value="Venezuela">Venezuela</option>
                                        </select>
                                    </div>
                                    <div class="form-group full-width">
                                        <label for="confTotal">Cantidad de Pedidos (Total)</label>
                                        <input type="number" id="confTotal" min="1" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="confConfirmed">Confirmados</label>
                                        <input type="number" id="confConfirmed" min="0" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="confDuplicates">Duplicados</label>
                                        <input type="number" id="confDuplicates" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="confCancelled">Cancelados (Cobertura)</label>
                                        <input type="number" id="confCancelled" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="confCancelledClient">Cancelados (Cliente)</label>
                                        <input type="number" id="confCancelledClient" min="0" value="0">
                                    </div>
                                </div>
                                <div class="form-actions" style="margin-top: 1rem;">
                                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z">
                                            </path>
                                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                            <polyline points="7 3 7 8 15 8"></polyline>
                                        </svg>
                                        Guardar Registro
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Live Stats -->
                    <div class="card">
                        <div class="card-header">
                            <h3>M√©tricas de Efectividad (En Vivo)</h3>
                        </div>
                        <div class="card-body" style="display: flex; flex-direction: column; gap: 1.5rem;">
                            <div style="text-align: center;">
                                <span
                                    style="font-size: 0.875rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Confirmaci√≥n
                                    Bruta</span>
                                <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary);"
                                    id="confPercentageValue">0%</div>
                                <p style="font-size: 0.875rem; color: var(--text-muted);" id="confStatsDetail">0 / 0
                                    Confirmados</p>
                            </div>
                            <div style="height: 1px; background: var(--border);"></div>
                            <div style="text-align: center;">
                                <span
                                    style="font-size: 0.875rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Efectividad
                                    Neta</span>
                                <div style="font-size: 2.5rem; font-weight: 700; color: var(--success);"
                                    id="confNetPercentageValue">0%</div>
                                <p style="font-size: 0.75rem; color: var(--text-muted);">(Excluye Dupli. y Cancel.
                                    Lineamiento)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent History -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Historial Reciente</h3>
                        </div>
                        <div class="card-body" style="padding: 0;">
                            <div class="table-container" style="border: none; border-radius: 0;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Fecha</th>
                                            <th>P√°gina</th>
                                            <th>% Conf.</th>
                                        </tr>
                                    </thead>
                                    <tbody id="confPreviewTable">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="card" style="margin-top: var(--space-lg);">
                    <div class="card-header">
                        <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                            </svg>
                            Filtrar Registros
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="filter-row"
                            style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end;">
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="filterDateFrom">Desde</label>
                                <input type="date" id="filterDateFrom" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="filterDateTo">Hasta</label>
                                <input type="date" id="filterDateTo" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="filterPage">P√°gina</label>
                                <select id="filterPage" class="form-control">
                                    <option value="">Todas</option>
                                    <option value="Colombia">Colombia</option>
                                    <option value="Ecuador">Ecuador</option>
                                    <option value="Venezuela">Venezuela</option>
                                </select>
                            </div>
                            <div class="filter-buttons" style="display: flex; gap: 0.5rem;">
                                <button type="button" class="btn btn-primary"
                                    onclick="ConfirmationModule.applyFilters()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                    Filtrar
                                </button>
                                <button type="button" class="btn btn-secondary"
                                    onclick="ConfirmationModule.clearFilters()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M3 6h18"></path>
                                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                    </svg>
                                    Limpiar
                                </button>
                            </div>
                        </div>
                        <!-- Filter Summary -->
                        <div id="filterSummary" class="filter-summary"
                            style="display: none; margin-top: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: var(--radius-md); font-size: 0.875rem;">
                            <span id="filterSummaryText"></span>
                        </div>
                    </div>
                </div>

                <!-- Full History Table -->
                <div class="card" style="margin-top: var(--space-lg);">
                    <div class="card-header">
                        <h3>Registro Completo</h3>
                        <span id="recordCount" style="font-size: 0.875rem; color: var(--text-muted);"></span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>P√°gina</th>
                                        <th>Total</th>
                                        <th>Conf.</th>
                                        <th>Dupli.</th>
                                        <th>C. Cob.</th>
                                        <th>C. Cli.</th>
                                        <th>% Bruta</th>
                                        <th>% Neta</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="confHistoryTable">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Purchases Section -->
            <section class="content-section" id="section-purchases">
                <div class="section-header">
                    <h2>Compras a Proveedores</h2>
                    <button class="btn btn-primary" onclick="PurchasesModule.openPurchaseModal()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Nueva Compra
                    </button>
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary-light); color: var(--primary);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalPurchases">0</span>
                            <span class="stat-label">Total Compras</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success-light); color: var(--success);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalSpent">$0</span>
                            <span class="stat-label">Total Gastado (COP)</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning-light); color: var(--warning);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="monthlySpent">$0</span>
                            <span class="stat-label">Este Mes (COP)</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--info-light); color: var(--info);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="uniqueProviders">0</span>
                            <span class="stat-label">Proveedores</span>
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="card-header">
                        <h3>Filtros</h3>
                    </div>
                    <div class="card-body">
                        <div class="filter-row"
                            style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end;">
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="purchaseFilterDateFrom">Desde</label>
                                <input type="date" id="purchaseFilterDateFrom" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="purchaseFilterDateTo">Hasta</label>
                                <input type="date" id="purchaseFilterDateTo" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="purchaseFilterProvider">Proveedor</label>
                                <select id="purchaseFilterProvider" class="form-control">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="filter-buttons" style="display: flex; gap: 0.5rem;">
                                <button type="button" class="btn btn-primary"
                                    onclick="PurchasesModule.applyFilters()">Filtrar</button>
                                <button type="button" class="btn btn-secondary"
                                    onclick="PurchasesModule.clearFilters()">Limpiar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Purchases Table -->
                <div class="card">
                    <div class="card-header">
                        <h3>Historial de Compras</h3>
                        <span id="purchaseRecordCount" style="font-size: 0.875rem; color: var(--text-muted);"></span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Proveedor</th>
                                        <th>Descripci√≥n</th>
                                        <th>Cantidad</th>
                                        <th>Monto (COP)</th>
                                        <th>M√©todo Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="purchasesTable">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Accounts Section (Admin Only) -->
            <section class="content-section" id="section-accounts">
                <div class="section-header">
                    <h2>Cuentas y Flujo de Efectivo</h2>
                    <div class="header-buttons">
                        <button class="btn btn-primary" onclick="AccountsModule.showTransactionModal()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Nueva Transacci√≥n
                        </button>
                        <button class="btn btn-secondary" onclick="AccountsModule.showAccountModal()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                            Nueva Cuenta
                        </button>
                    </div>
                </div>

                <!-- Accounts Cards -->
                <div class="accounts-grid" id="accountsGrid"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                    <!-- Dynamic accounts cards -->
                </div>

                <!-- Summary Stats -->
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(34, 197, 94, 0.1); color: #22c55e;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                                <polyline points="17 6 23 6 23 12"></polyline>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="accountsTotalIncome" style="color: var(--success);">$0</span>
                            <span class="stat-label">Total Ingresos (Mes)</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: #ef4444;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
                                <polyline points="17 18 23 18 23 12"></polyline>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="accountsTotalExpenses" style="color: var(--danger);">$0</span>
                            <span class="stat-label">Total Gastos (Mes)</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(99, 102, 241, 0.1); color: #6366f1;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="accountsBalance">$0</span>
                            <span class="stat-label">Balance Neto (Mes)</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="accountsTotalBalance" style="color: #8b5cf6;">$0</span>
                            <span class="stat-label">Saldo Total Cuentas</span>
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="card-header">
                        <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                            </svg>
                            Filtrar Transacciones
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="filter-row"
                            style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: flex-end;">
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="accountsFilterDateFrom">Desde</label>
                                <input type="date" id="accountsFilterDateFrom" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="accountsFilterDateTo">Hasta</label>
                                <input type="date" id="accountsFilterDateTo" class="form-control">
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="accountsFilterAccount">Cuenta</label>
                                <select id="accountsFilterAccount" class="form-control">
                                    <option value="">Todas</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="accountsFilterType">Tipo</label>
                                <select id="accountsFilterType" class="form-control">
                                    <option value="">Todos</option>
                                    <option value="income">Ingresos</option>
                                    <option value="expense">Gastos</option>
                                    <option value="transfer">Transferencias</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1; min-width: 150px;">
                                <label for="accountsFilterCategory">Categor√≠a</label>
                                <select id="accountsFilterCategory" class="form-control">
                                    <option value="">Todas</option>
                                </select>
                            </div>
                            <div class="filter-buttons" style="display: flex; gap: 0.5rem;">
                                <button type="button" class="btn btn-primary"
                                    onclick="AccountsModule.applyFilters()">Filtrar</button>
                                <button type="button" class="btn btn-secondary"
                                    onclick="AccountsModule.clearFilters()">Limpiar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions Table -->
                <div class="card">
                    <div class="card-header">
                        <h3>Historial de Transacciones</h3>
                        <span id="transactionsRecordCount"
                            style="font-size: 0.875rem; color: var(--text-muted);"></span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Cuenta</th>
                                        <th>Categor√≠a</th>
                                        <th>Descripci√≥n</th>
                                        <th>Tipo</th>
                                        <th>Monto</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTable">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Section (Admin Only) -->
            <section class="content-section" id="section-users">
                <div class="section-header">
                    <h2>Administraci√≥n de Usuarios</h2>
                </div>

                <!-- Users List -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="card-header">
                        <h3>Usuarios del Sistema</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Usuario</th>
                                        <th>Nombre</th>
                                        <th>Rol</th>
                                        <th>Estado</th>
                                        <th>√öltimo Acceso</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Permissions Manager -->
                <div class="card" id="permissionsCard" style="display: none;">
                    <div class="card-header">
                        <h3>Permisos de: <span id="permissionsUserName"></span></h3>
                    </div>
                    <div class="card-body">
                        <p style="color: var(--text-muted); margin-bottom: 1rem;">Habilita o deshabilita el acceso a
                            cada m√≥dulo para este usuario.</p>
                        <div class="permissions-grid" id="permissionsGrid"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                            <!-- Dynamic permissions toggles -->
                        </div>
                        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="UsersModule.savePermissions()">Guardar
                                Permisos</button>
                            <button class="btn btn-secondary" onclick="UsersModule.closePermissions()">Cancelar</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Campaigns Section -->
            <section class="content-section" id="section-campaigns">
                <div class="section-header">
                    <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        Creaci√≥n de Campa√±as
                    </h2>
                </div>

                <!-- Campaign Generator Card -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="card-header"
                        style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
                        <h3 style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polygon
                                    points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                </polygon>
                            </svg>
                            Generador de Nombre de Campa√±a
                        </h3>
                    </div>
                    <div class="card-body">
                        <form id="campaignForm">
                            <div class="form-grid"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <!-- Country Select -->
                                <div class="form-group">
                                    <label for="campaignCountry">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2"
                                            style="display: inline; vertical-align: middle; margin-right: 4px;">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="2" y1="12" x2="22" y2="12"></line>
                                            <path
                                                d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                            </path>
                                        </svg>
                                        Pa√≠s *
                                    </label>
                                    <select id="campaignCountry" class="form-control" required>
                                        <option value="">Seleccione pa√≠s...</option>
                                        <option value="ECU">üá™üá® Ecuador (ECU)</option>
                                        <option value="VEN">üáªüá™ Venezuela (VEN)</option>
                                        <option value="COL">üá®üá¥ Colombia (COL)</option>
                                    </select>
                                </div>

                                <!-- Type Select -->
                                <div class="form-group">
                                    <label for="campaignType">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2"
                                            style="display: inline; vertical-align: middle; margin-right: 4px;">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="3" y1="9" x2="21" y2="9"></line>
                                            <line x1="9" y1="21" x2="9" y2="9"></line>
                                        </svg>
                                        Tipo *
                                    </label>
                                    <select id="campaignType" class="form-control" required>
                                        <option value="">Seleccione tipo...</option>
                                        <option value="ABO">ABO</option>
                                        <option value="CBO">CBO</option>
                                    </select>
                                </div>

                                <!-- Objective Select -->
                                <div class="form-group">
                                    <label for="campaignObjective">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2"
                                            style="display: inline; vertical-align: middle; margin-right: 4px;">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <circle cx="12" cy="12" r="6"></circle>
                                            <circle cx="12" cy="12" r="2"></circle>
                                        </svg>
                                        Objetivo *
                                    </label>
                                    <select id="campaignObjective" class="form-control" required>
                                        <option value="">Seleccione objetivo...</option>
                                        <option value="MENSAJES">Mensajes</option>
                                        <option value="COMPRAS">Compras</option>
                                    </select>
                                </div>

                                <!-- Date Picker -->
                                <div class="form-group">
                                    <label for="campaignDate">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2"
                                            style="display: inline; vertical-align: middle; margin-right: 4px;">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                        Fecha *
                                    </label>
                                    <input type="date" id="campaignDate" class="form-control" required>
                                </div>

                                <!-- Product Select -->
                                <div class="form-group">
                                    <label for="campaignProductSearch">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2"
                                            style="display: inline; vertical-align: middle; margin-right: 4px;">
                                            <path
                                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                            </path>
                                        </svg>
                                        Producto *
                                    </label>
                                    <div class="autocomplete-container">
                                        <input type="text" id="campaignProductSearch" placeholder="Buscar producto..."
                                            autocomplete="off">
                                        <input type="hidden" id="campaignProduct">
                                        <div class="autocomplete-suggestions" id="campaignProductSuggestions"></div>
                                    </div>
                                </div>

                                <!-- Ad Sets -->
                                <div class="form-group">
                                    <label for="campaignAdSets">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2"
                                            style="display: inline; vertical-align: middle; margin-right: 4px;">
                                            <rect x="3" y="3" width="7" height="7"></rect>
                                            <rect x="14" y="3" width="7" height="7"></rect>
                                            <rect x="14" y="14" width="7" height="7"></rect>
                                            <rect x="3" y="14" width="7" height="7"></rect>
                                        </svg>
                                        Conjuntos de Anuncios
                                    </label>
                                    <input type="number" id="campaignAdSets" class="form-control" placeholder="Ej: 3"
                                        min="0" max="100">
                                </div>

                                <!-- Ads -->
                                <div class="form-group">
                                    <label for="campaignAds">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2"
                                            style="display: inline; vertical-align: middle; margin-right: 4px;">
                                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                                        </svg>
                                        Anuncios
                                    </label>
                                    <input type="number" id="campaignAds" class="form-control" placeholder="Ej: 6"
                                        min="0" max="100">
                                </div>
                            </div>

                            <!-- Preview -->
                            <div id="campaignPreview" class="campaign-preview"
                                style="display: none; margin-top: 1.5rem; padding: 1rem; background: rgba(99, 102, 241, 0.1); border: 2px dashed var(--primary); border-radius: var(--radius-md); text-align: center;">
                                <span
                                    style="font-size: 0.85rem; color: var(--text-muted); display: block; margin-bottom: 0.5rem;">Vista
                                    previa:</span>
                                <span id="campaignPreviewText"
                                    style="font-family: monospace; font-size: 1.25rem; font-weight: 700; color: var(--primary);"></span>
                                <div id="campaignAdInfo"></div>
                            </div>

                            <!-- Buttons -->
                            <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button type="submit" class="btn btn-primary">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <polygon
                                            points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                                        </polygon>
                                    </svg>
                                    Generar Nombre
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="CampaignsModule.resetForm()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <polyline points="1 4 1 10 7 10"></polyline>
                                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                                    </svg>
                                    Limpiar
                                </button>
                            </div>
                        </form>

                        <!-- Result -->
                        <div id="campaignResult" class="campaign-result"
                            style="display: none; margin-top: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05)); border: 2px solid #10b981; border-radius: var(--radius-lg); text-align: center;">
                            <div
                                style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981"
                                    stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                                <span style="font-size: 1rem; font-weight: 600; color: #10b981;">Nombre de Campa√±a
                                    Generado:</span>
                            </div>
                            <div id="campaignResultText"
                                style="font-family: monospace; font-size: 1.5rem; font-weight: 700; color: var(--text-primary); padding: 0.75rem; background: var(--bg-secondary); border-radius: var(--radius-md); word-break: break-all;">
                            </div>
                            <div id="campaignResultAdInfo"></div>
                            <div id="campaignResultCodes"></div>
                            <button type="button" class="btn btn-success" style="margin-top: 1rem;"
                                onclick="CampaignsModule.copyToClipboard()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                Copiar Nombre
                            </button>
                        </div>
                    </div>
                </div>

                <!-- History Card -->
                <div class="card">
                    <div class="card-header">
                        <h3>Historial de Campa√±as Generadas</h3>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="CampaignsModule.clearHistory()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                </path>
                            </svg>
                            Limpiar Historial
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Nombre de Campa√±a</th>
                                        <th>Pa√≠s</th>
                                        <th>Tipo</th>
                                        <th>Fecha</th>
                                        <th style="text-align: center;">Conjuntos</th>
                                        <th style="text-align: center;">Anuncios</th>
                                        <th>Creado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="campaignsHistoryTable">
                                    <tr>
                                        <td colspan="9"
                                            style="text-align: center; color: var(--text-muted); padding: 2rem;">
                                            No hay campa√±as generadas a√∫n
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Upload Reports Card -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 8px;">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Subir Reportes de Rendimiento
                        </h3>
                    </div>
                    <div class="card-body">
                        <div
                            style="background: var(--surface-hover); border: 2px dashed var(--border); border-radius: var(--radius-lg); padding: 2rem; text-align: center;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)"
                                stroke-width="1.5" style="margin-bottom: 1rem;">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                                Arrastra tu archivo Excel aqu√≠ o haz clic para seleccionar
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">
                                Formatos aceptados: .xlsx, .xls, .csv
                            </div>
                            <input type="file" id="reportFileInput" accept=".xlsx,.xls,.csv" style="display: none;"
                                onchange="CampaignsModule.handleReportUpload(this)">
                            <button type="button" class="btn btn-primary"
                                onclick="document.getElementById('reportFileInput').click()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Seleccionar Archivo
                            </button>
                        </div>
                        <div id="reportUploadStatus" style="display: none; margin-top: 1rem;"></div>
                        <div id="reportPreview" style="display: none; margin-top: 1.5rem;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4 style="margin: 0;">Vista Previa del Reporte</h4>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn btn-success btn-sm"
                                        onclick="CampaignsModule.confirmReportUpload()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                        </svg>
                                        Confirmar y Asociar
                                    </button>
                                    <button class="btn btn-secondary btn-sm"
                                        onclick="CampaignsModule.cancelReportUpload()">
                                        Cancelar
                                    </button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="table">
                                    <thead id="reportPreviewHead"></thead>
                                    <tbody id="reportPreviewBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Campaign Performance Card -->
                <div class="card">
                    <div class="card-header">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 8px;">
                                <line x1="18" y1="20" x2="18" y2="10"></line>
                                <line x1="12" y1="20" x2="12" y2="4"></line>
                                <line x1="6" y1="20" x2="6" y2="14"></line>
                            </svg>
                            Rendimiento de Campa√±as
                        </h3>
                        <button type="button" class="btn btn-secondary btn-sm"
                            onclick="CampaignsModule.clearPerformanceData()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                </path>
                            </svg>
                            Limpiar Datos
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Campa√±a</th>
                                        <th style="text-align: right;">Gastado (COP)</th>
                                        <th style="text-align: center;">Compras</th>
                                        <th style="text-align: right;">CPC</th>
                                        <th style="text-align: right;">CPM</th>
                                        <th style="text-align: right;">Costo/Compra</th>
                                        <th>Per√≠odo</th>
                                    </tr>
                                </thead>
                                <tbody id="campaignPerformanceTable">
                                    <tr>
                                        <td colspan="8"
                                            style="text-align: center; color: var(--text-muted); padding: 2rem;">
                                            No hay datos de rendimiento. Sube un reporte para ver el rendimiento.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div><!-- End app-container -->

    <!-- Modal: Product Form -->
    <div class="modal" id="modalProduct">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalProductTitle">Nuevo Producto</h2>
                <button class="modal-close" data-close="modalProduct">&times;</button>
            </div>
            <form id="formProduct">
                <input type="hidden" id="productId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="productName">Nombre del Producto *</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label for="productImportNumber">N√∫mero de Importaci√≥n *</label>
                        <input type="number" id="productImportNumber" min="1" required placeholder="Ej: 1, 2, 3, 4">
                    </div>
                    <div class="form-group">
                        <label for="productSku">SKU / C√≥digo (Autom√°tico)</label>
                        <input type="text" id="productSku" readonly
                            style="background-color: var(--bg-secondary); cursor: not-allowed;">
                    </div>
                    <div class="form-group full-width">
                        <label for="productDescription">Descripci√≥n</label>
                        <textarea id="productDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="productCategory">Categor√≠a *</label>
                        <select id="productCategory" required>
                            <option value="">Seleccionar categor√≠a...</option>
                            <option value="Relojes">Relojes</option>
                            <option value="Accesorios">Accesorios</option>
                            <option value="Repuestos">Repuestos</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productCost">Costo ($)</label>
                        <input type="number" id="productCost" step="0.01" min="0" placeholder="Precio de compra">
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Precio ($) *</label>
                        <input type="number" id="productPrice" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="productActive">Estado</label>
                        <label class="switch">
                            <input type="checkbox" id="productActive" checked>
                            <span class="slider"></span>
                            <span class="switch-label">Activo</span>
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-close="modalProduct">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Client Form -->
    <div class="modal" id="modalClient">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalClientTitle">Nuevo Cliente</h2>
                <button class="modal-close" data-close="modalClient">&times;</button>
            </div>
            <form id="formClient">
                <input type="hidden" id="clientId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="clientName">Nombre Completo *</label>
                        <input type="text" id="clientName" required>
                    </div>
                    <div class="form-group">
                        <label for="clientPhone">Tel√©fono *</label>
                        <input type="tel" id="clientPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="clientCity">Ciudad *</label>
                        <select id="clientCity" required>
                            <option value="">Seleccionar...</option>
                            <option value="Quito">Quito</option>
                            <option value="Guayaquil">Guayaquil</option>
                            <option value="Caracas">Caracas</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="clientAddress">Direcci√≥n Completa *</label>
                        <textarea id="clientAddress" rows="2" required></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label for="clientReference">Referencias</label>
                        <input type="text" id="clientReference" placeholder="Ej: Casa blanca, junto al parque">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-close="modalClient">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Stock Update -->
    <div class="modal" id="modalStock">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Actualizar Stock</h2>
                <button class="modal-close" data-close="modalStock">&times;</button>
            </div>
            <form id="formStock">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="stockProduct">Producto *</label>
                        <select id="stockProduct" required>
                            <option value="">Seleccionar producto...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stockCity">Ciudad *</label>
                        <select id="stockCity" required>
                            <option value="">Seleccionar ciudad...</option>
                            <option value="Quito">Quito</option>
                            <option value="Guayaquil">Guayaquil</option>
                            <option value="Caracas">Caracas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stockMovementType">Tipo de Movimiento *</label>
                        <select id="stockMovementType" required>
                            <option value="entrada">‚ûï Entrada (Agregar)</option>
                            <option value="salida">‚ûñ Salida (Quitar)</option>
                            <option value="ajuste">üõ†Ô∏è Ajuste / Correcci√≥n (Fijar Valor)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="stockQuantity">Cantidad *</label>
                        <input type="number" id="stockQuantity" min="1" required>
                    </div>
                    <div class="form-group full-width">
                        <label for="stockReason">Motivo del Movimiento *</label>
                        <input type="text" id="stockReason" required
                            placeholder="Ej: Reposici√≥n de mercanc√≠a, Venta directa, Da√±o de producto...">
                    </div>
                    <div class="form-group">
                        <label for="stockMinimum">Stock m√≠nimo</label>
                        <input type="number" id="stockMinimum" min="0" value="5">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-close="modalStock">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="btnSubmitStock">Registrar Movimiento</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: New Guide -->
    <div class="modal modal-large" id="modalGuide">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalGuideTitle">Nueva Gu√≠a de Despacho</h2>
                <button class="modal-close" data-close="modalGuide">&times;</button>
            </div>
            <form id="formGuide">
                <input type="hidden" id="guideId">
                <div class="guide-form-layout">
                    <div class="guide-section">
                        <h3>Informaci√≥n del Cliente</h3>
                        <div class="form-group">
                            <label for="guideClientSearch">Buscar Cliente</label>
                            <div class="autocomplete-container">
                                <input type="text" id="guideClientSearch"
                                    placeholder="Escriba nombre o tel√©fono del cliente..." autocomplete="off">
                                <input type="hidden" id="guideClient">
                                <div class="autocomplete-suggestions" id="clientSuggestions"></div>
                            </div>
                        </div>
                        <div class="client-info" id="selectedClientInfo" style="display: none;">
                            <p><strong>Nombre:</strong> <span id="infoClientName"></span></p>
                            <p><strong>Tel√©fono:</strong> <span id="infoClientPhone"></span></p>
                            <p><strong>Direcci√≥n:</strong> <span id="infoClientAddress"></span></p>
                            <p><strong>Ciudad:</strong> <span id="infoClientCity"></span></p>
                            <button type="button" class="btn btn-sm btn-secondary"
                                onclick="GuidesModule.clearClientSelection()" style="margin-top: 0.5rem;">
                                Cambiar cliente
                            </button>
                        </div>
                    </div>

                    <div class="guide-section">
                        <h3>Productos</h3>
                        <div class="add-product-row" style="flex-wrap: wrap; gap: 0.5rem;">
                            <div class="autocomplete-container" style="flex: 1; min-width: 200px;">
                                <input type="text" id="guideProductSearch" placeholder="Buscar producto..."
                                    autocomplete="off">
                                <input type="hidden" id="guideProductSelect">
                                <div class="autocomplete-suggestions" id="productSuggestions"></div>
                            </div>
                            <span id="selectedProductStock"
                                style="color: var(--text-muted); font-size: 0.85rem; display: none;"></span>
                            <input type="number" id="guideProductPrice" step="0.01" placeholder="Precio"
                                style="width: 100px;">
                            <input type="number" id="guideProductQty" min="1" value="1" placeholder="Cant."
                                style="width: 70px;">
                            <button type="button" class="btn btn-secondary" id="btnAddProductToGuide">Agregar</button>
                        </div>
                        <div class="guide-products-list">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Cantidad</th>
                                        <th>Precio</th>
                                        <th>Subtotal</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="guideProductsTable">
                                    <!-- Dynamic content -->
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="3"><strong>TOTAL</strong></td>
                                        <td colspan="2"><strong id="guideTotal">$0.00</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <div class="guide-section">
                        <!-- Campos espec√≠ficos para Caracas -->
                        <div id="caracasFields"
                            style="display: none; background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
                            <h4 style="margin-bottom: 0.5rem; color: var(--primary);">Datos para Caracas</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="guideAmountUsd">Monto a cancelar ($ USD)</label>
                                    <input type="number" id="guideAmountUsd" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="guidePaymentBs">Pago M√≥vil (Bol√≠vares)</label>
                                    <input type="number" id="guidePaymentBs" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label for="guideDeliveryTime">Hora de entrega</label>
                                    <input type="time" id="guideDeliveryTime">
                                </div>
                            </div>
                        </div>

                        <!-- Valor de Flete - Campo general -->
                        <div class="form-group">
                            <label for="guideShippingCost">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2"
                                    style="display: inline; vertical-align: middle; margin-right: 4px;">
                                    <rect x="1" y="3" width="15" height="13"></rect>
                                    <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                                    <circle cx="5.5" cy="18.5" r="2.5"></circle>
                                    <circle cx="18.5" cy="18.5" r="2.5"></circle>
                                </svg>
                                Valor de Flete
                            </label>
                            <input type="number" id="guideShippingCost" min="0" step="0.01" placeholder="0.00">
                        </div>

                        <div class="form-group full-width">
                            <label for="guideObservations">Observaciones</label>
                            <textarea id="guideObservations" rows="2"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-close="modalGuide">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Gu√≠a</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Guide Details -->
    <div class="modal modal-large" id="modalGuideDetails">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gu√≠a de Despacho <span id="detailGuideNumber"></span></h2>
                <button class="modal-close" data-close="modalGuideDetails">&times;</button>
            </div>
            <div class="guide-details" id="guideDetailsContent">
                <!-- Dynamic content -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" data-close="modalGuideDetails">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btnPrintGuide">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                    Imprimir / PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Adjust Shipping Cost -->
    <div class="modal" id="modalAdjustShipping">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        style="display: inline; vertical-align: middle; margin-right: 6px;">
                        <rect x="1" y="3" width="15" height="13"></rect>
                        <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                    </svg>
                    Ajustar Flete ‚Äî <span id="adjustShippingGuideNumber" style="color: var(--primary);"></span>
                </h2>
                <button class="modal-close" data-close="modalAdjustShipping">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <!-- Info banner -->
                <div
                    style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1)); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                        <span style="font-size: 1.5rem;">üìù</span>
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">
                                Ajuste de Valor de Flete
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-muted);">
                                El precio inicial del flete es estimado. Use esta funci√≥n para actualizarlo con el valor
                                real
                                una vez confirmado por la transportadora (generalmente despu√©s de 15 d√≠as).
                            </div>
                            <div id="adjustShippingDaysInfo"
                                style="font-size: 0.8rem; color: var(--primary); margin-top: 0.5rem; font-weight: 500;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Current cost info -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div
                        style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 1rem; text-align: center;">
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">Flete Actual
                        </div>
                        <div id="adjustShippingCurrentCost"
                            style="font-size: 1.25rem; font-weight: 700; color: var(--text-primary);">$0.00</div>
                    </div>
                    <div id="adjustShippingOriginalInfo"
                        style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 1rem; text-align: center; display: none;">
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem;">Flete Original
                        </div>
                        <div id="adjustShippingOriginalCost"
                            style="font-size: 1.25rem; font-weight: 700; color: var(--text-secondary);">$0.00</div>
                    </div>
                </div>

                <!-- Form -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="adjustShippingNewCost" style="font-weight: 600;">
                            üí∞ Nuevo Valor de Flete *
                        </label>
                        <input type="number" id="adjustShippingNewCost" min="0" step="0.01" placeholder="0.00"
                            style="font-size: 1.15rem; padding: 0.75rem;">
                    </div>
                    <div class="form-group">
                        <label for="adjustShippingNote">
                            üìù Nota del Ajuste
                        </label>
                        <input type="text" id="adjustShippingNote"
                            placeholder="Ej: Precio real confirmado por transportadora">
                    </div>
                </div>

                <div class="form-actions" style="margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" data-close="modalAdjustShipping">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="GuidesModule.saveShippingAdjustment()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Guardar Ajuste de Flete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Incident Management (Gesti√≥n de Novedad) -->
    <div class="modal modal-large" id="modalNovedadGestion">
        <div class="modal-content">
            <div class="modal-header"
                style="background: linear-gradient(135deg, rgba(234, 88, 12, 0.1), rgba(249, 115, 22, 0.1));">
                <h2 style="display: flex; align-items: center; gap: 0.5rem;">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ea580c" stroke-width="2">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                        </path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    Gesti√≥n de Novedad ‚Äî <span id="novedadGuideNumber" style="color: #ea580c;"></span>
                </h2>
                <button class="modal-close" data-close="modalNovedadGestion">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <!-- Guide info summary -->
                <div id="novedadGuideInfo"
                    style="background: var(--surface-hover); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 1.5rem;">
                    <!-- Dynamic content -->
                </div>

                <!-- Existing gestiones timeline -->
                <div style="margin-bottom: 1.5rem;">
                    <h3
                        style="font-size: 0.95rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        Historial de Gestiones
                    </h3>
                    <div id="novedadTimeline">
                        <!-- Dynamic timeline -->
                    </div>
                </div>

                <!-- Add new gestion form -->
                <div
                    style="background: linear-gradient(135deg, rgba(234, 88, 12, 0.05), rgba(249, 115, 22, 0.08)); border: 1px solid rgba(234, 88, 12, 0.2); border-radius: var(--radius-md); padding: 1.25rem;">
                    <h3
                        style="font-size: 0.95rem; font-weight: 600; margin-bottom: 1rem; color: #ea580c; display: flex; align-items: center; gap: 0.5rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Agregar Nueva Gesti√≥n
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="novedadActionType" style="font-weight: 600;">
                                üìã Tipo de Gesti√≥n *
                            </label>
                            <select id="novedadActionType">
                                <option value="">Seleccionar tipo...</option>
                                <option value="Reprogramaci√≥n">üìÖ Reprogramaci√≥n</option>
                                <option value="Gesti√≥n N¬∞1">üìû Gesti√≥n N¬∞1</option>
                                <option value="Gesti√≥n N¬∞2">üìû Gesti√≥n N¬∞2</option>
                                <option value="Gesti√≥n N¬∞3">üìû Gesti√≥n N¬∞3</option>
                                <option value="Contacto cliente">üë§ Contacto cliente</option>
                                <option value="Cambio direcci√≥n">üìç Cambio direcci√≥n</option>
                                <option value="Intento entrega">üöö Intento entrega</option>
                                <option value="Otro">üìù Otro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="novedadActionDescription">
                                üí¨ Descripci√≥n / Observaci√≥n
                            </label>
                            <textarea id="novedadActionDescription" rows="2"
                                placeholder="Detalle de la gesti√≥n realizada..."></textarea>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 0.75rem; margin-top: 1rem;">
                        <button type="button" class="btn btn-primary" onclick="GuidesModule.saveNovedadAction()"
                            style="background: linear-gradient(135deg, #ea580c, #f97316);">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Registrar Gesti√≥n
                        </button>
                    </div>
                </div>

                <!-- Actions -->
                <div class="form-actions" style="margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" data-close="modalNovedadGestion">Cerrar</button>
                    <button type="button" class="btn btn-success" onclick="GuidesModule.resolveNovedad()"
                        title="Marcar como resuelta y cambiar estado">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Novedad Resuelta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Purchase Form -->
    <div class="modal" id="modalPurchase">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalPurchaseTitle">Nueva Compra</h2>
                <button class="modal-close" data-close="modalPurchase">&times;</button>
            </div>
            <form id="formPurchase">
                <input type="hidden" id="purchaseId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="purchaseDate">Fecha *</label>
                        <input type="date" id="purchaseDate" required>
                    </div>
                    <div class="form-group">
                        <label for="purchaseProvider">Proveedor *</label>
                        <input type="text" id="purchaseProvider" required placeholder="Nombre del proveedor">
                    </div>
                    <div class="form-group full-width">
                        <label for="purchaseDescription">Descripci√≥n *</label>
                        <input type="text" id="purchaseDescription" required placeholder="Qu√© compraste">
                    </div>
                    <div class="form-group">
                        <label for="purchaseQuantity">Cantidad</label>
                        <input type="number" id="purchaseQuantity" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="purchaseAmount">Monto (COP) *</label>
                        <input type="number" id="purchaseAmount" required min="0" step="100" placeholder="50000">
                    </div>
                    <div class="form-group">
                        <label for="purchasePaymentMethod">M√©todo de Pago</label>
                        <select id="purchasePaymentMethod">
                            <option value="Efectivo">Efectivo</option>
                            <option value="Transferencia">Transferencia</option>
                            <option value="Nequi">Nequi</option>
                            <option value="Daviplata">Daviplata</option>
                            <option value="Tarjeta">Tarjeta</option>
                            <option value="Cr√©dito">Cr√©dito (A pagar)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="purchaseCategory">Categor√≠a</label>
                        <select id="purchaseCategory">
                            <option value="Mercanc√≠a">Mercanc√≠a</option>
                            <option value="Insumos">Insumos</option>
                            <option value="Empaque">Empaque</option>
                            <option value="Publicidad">Publicidad</option>
                            <option value="Transporte">Transporte</option>
                            <option value="Servicios">Servicios</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="purchaseNotes">Notas adicionales</label>
                        <textarea id="purchaseNotes" rows="2" placeholder="Observaciones..."></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-close="modalPurchase">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Compra</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Transaction Form -->
    <div class="modal" id="modalTransaction">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTransactionTitle">Nueva Transacci√≥n</h2>
                <button class="modal-close" data-close="modalTransaction">&times;</button>
            </div>
            <form id="formTransaction">
                <input type="hidden" id="transactionId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="transactionType">Tipo *</label>
                        <select id="transactionType" required onchange="AccountsModule.onTransactionTypeChange()">
                            <option value="income">Ingreso</option>
                            <option value="expense">Gasto</option>
                            <option value="transfer">Transferencia entre Cuentas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionAccount" id="labelTransactionAccount">Cuenta *</label>
                        <select id="transactionAccount" required>
                            <!-- Dynamic options -->
                        </select>
                    </div>
                    <div class="form-group" id="targetAccountGroup" style="display: none;">
                        <label for="transactionTargetAccount">Cuenta Destino *</label>
                        <select id="transactionTargetAccount">
                            <!-- Dynamic options -->
                        </select>
                    </div>
                    <div class="form-group" id="categoryGroup">
                        <label for="transactionCategory">Categor√≠a *</label>
                        <select id="transactionCategory" required>
                            <!-- Dynamic options -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionAmount">Monto (COP) *</label>
                        <input type="number" id="transactionAmount" required min="0" step="100" placeholder="50000">
                    </div>
                    <div class="form-group">
                        <label for="transactionDate">Fecha *</label>
                        <input type="date" id="transactionDate" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionReference">Referencia</label>
                        <input type="text" id="transactionReference" placeholder="N√∫mero de factura, recibo, etc.">
                    </div>
                    <div class="form-group full-width">
                        <label for="transactionDescription">Descripci√≥n</label>
                        <textarea id="transactionDescription" rows="2"
                            placeholder="Detalles de la transacci√≥n..."></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-close="modalTransaction">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Transacci√≥n</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Account Form -->
    <div class="modal" id="modalAccount">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalAccountTitle">Nueva Cuenta</h2>
                <button class="modal-close" data-close="modalAccount">&times;</button>
            </div>
            <form id="formAccount">
                <input type="hidden" id="accountId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="accountName">Nombre de la Cuenta *</label>
                        <input type="text" id="accountName" required placeholder="Ej: Nequi, Nubank">
                    </div>
                    <div class="form-group">
                        <label for="accountType">Tipo *</label>
                        <select id="accountType" required>
                            <option value="billetera">Billetera Digital</option>
                            <option value="banco">Cuenta Bancaria</option>
                            <option value="efectivo">Efectivo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="accountCurrency">Moneda</label>
                        <select id="accountCurrency">
                            <option value="COP">COP - Peso Colombiano</option>
                            <option value="USD">USD - D√≥lar</option>
                            <option value="VES">VES - Bol√≠var</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="accountInitialBalance">Saldo Inicial</label>
                        <input type="number" id="accountInitialBalance" min="0" step="100" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="accountColor">Color</label>
                        <input type="color" id="accountColor" value="#6366f1">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-close="modalAccount">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cuenta</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Inventory History -->
    <div class="modal modal-large" id="modalInventoryHistory">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Historial de Movimientos de Inventario</h2>
                <button class="modal-close" data-close="modalInventoryHistory">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="filters-bar" style="margin-bottom: 1rem;">
                    <select id="filterHistoryCity">
                        <option value="">Todas las ciudades</option>
                        <option value="Quito">Quito</option>
                        <option value="Guayaquil">Guayaquil</option>
                        <option value="Caracas">Caracas</option>
                    </select>
                    <select id="filterHistoryType">
                        <option value="">Todos los tipos</option>
                        <option value="entrada">Entradas</option>
                        <option value="salida">Salidas</option>
                    </select>
                    <input type="date" id="filterHistoryDate"
                        style="padding: 0.5rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-md); color: var(--text-primary);">
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Fecha/Hora</th>
                                <th>Producto</th>
                                <th>Ciudad</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Anterior</th>
                                <th>Nuevo</th>
                                <th>Motivo</th>
                                <th>Usuario</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryHistoryTable">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/database.js"></script>
    <script src="js/products.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/clients.js"></script>
    <script src="js/guides.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/confirmation.js"></script>
    <script src="js/purchases.js"></script>
    <script src="js/accounts.js"></script>
    <script src="js/users.js"></script>
    <script src="js/campaigns.js"></script>
    <script src="js/app.js"></script>
    <script src="js/auth.js"></script>
</body>

</html>